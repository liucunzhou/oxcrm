<!-- 面包屑 -->
<div class="breadcrumbs" id="breadcrumbs">
    <ul class="breadcrumb">
        <li>首页</li>
        <li>客资管理</li>
        <li>批量导入</li>
    </ul>
    <div class="widget-toolbar">
        <a href="javascript:history.go(-1);">
            <span class="glyphicon glyphicon-share-alt"></span>
            <span class="text">返回</span>
        </a>
    </div>
    <div class="widget-toolbar">
        <a href="/cutomer_template.csv" target="_blank">
            <span class="glyphicon glyphicon-download"></span>
            <span class="text">下载模版</span>
        </a>
    </div>
    <div class="widget-toolbar">
        <a href="javascript:void(0);" class="btn-import">
            <span class="glyphicon glyphicon-upload"></span>
            <span class="text">上传客资</span>
        </a>
        <form class="form_import hide" action="{:url('Customer/import')}" enctype="multipart/form-data" method="post">
            <input type="file" name="csv" id="csv">
        </form>
    </div>
    <div class="widget-toolbar no-border">
        <form>
            <input type="text" name="keywords" placeholder="请输入客户资料"/>
            <a class="icon-search" href="javascript:void(0);"></a>
        </form>
    </div>
</div>
<!--页面详情-->
<div class="page-content">
    <table class="table table-striped table-bordered table-hover">
        <thead>
            <tr>
                <th class="left">客户名称</th>
                <th class="left">联系方式</th>
                <th class="left">其他联系</th>
                <th class="left">宴会规模</th>
                <th class="left">预算</th>
                <th class="left">发布状态</th>
                <th class="left">备注</th>
                <th class="left">婚期</th>
                <th class="left">区域</th>
                <th class="left">咨询酒店</th>
            </tr>
        </thead>
        <{foreach item="val" name="data"}>
            <{if $key>0}>
                <tr>
                    <th class="left">{$val[0]}</th>
                    <th class="left">{$val[1]}</th>
                    <th class="left">{$val[2]}</th>
                    <th class="left">{$val[3]}</th>
                    <th class="left">{$val[4]}</th>
                    <th class="left">{$val[5]}</th>
                    <th class="left">{$val[6]}</th>
                    <th class="left">{$val[7]}</th>
                    <th class="left">{$val[8]}</th>
                    <th class="left">{$val[9]}</th>
                </tr>
            <{/if}>
        <{/foreach}>
    </table>
</div>

<div class="fixed-bottom">
    <div class="toolbar-bottom pull-left">
        <a class="btn btn-xs btn-warning action-modal" href="javascript:void(0);" data-action="{:url('Customer/allocate',['id'=>$val['id']])}">
            导入并分配
        </a>
        <a class="btn btn-xs btn-info">
            导出重复
        </a>
    </div>
</div>

<script>
    $(function () {
        $(".btn-import").click(function () {
            $("#csv").click();
        });

        $("#csv").change(function () {
            // alert("开始了上传");
            $(".form_import").submit()
        });



        $(document).on('blur', '.user_amount', function () {
            // layer.msg("hahaha");
            var _this = $(this),
                totals = parseInt($(".amount").html());

            var sum = 0;
            $(".user_amount").each(function(i, n){
                var val = $(n).val();
                if(!isNaN(val)) {
                    var current = parseInt(val);
                    sum = sum + current;
                }
            });

            if(sum > totals) {
                layer.msg("分配已超出,请调整");
            } else {
                $(".assigned_amount").html(sum);
                var left = totals - sum;
                $(".unassigned_amount").html(left);
            }
        });
    });
</script>